# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö LoL Meta Analyzer

## üéØ –¶–µ–ª—å
–°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (Win/Pick/Ban rate) —á–µ–º–ø–∏–æ–Ω–æ–≤ –¥–ª—è —Ä–∞–Ω–≥–æ–≤ **Emerald+** –Ω–∞ RU —Å–µ—Ä–≤–µ—Ä–µ.
–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ç—á–µ–π –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –º–∞—Ç—á–µ–π.

## üö´ –ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
–ï—Å–ª–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –∏–¥–µ–º –ø–æ –∏–≥—Ä–æ–∫–∞–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö –º–∞—Ç—á–∏, –º—ã –Ω–µ–∏–∑–±–µ–∂–Ω–æ —Å—Ç–æ–ª–∫–Ω–µ–º—Å—è —Å —Å–∏—Ç—É–∞—Ü–∏–µ–π:
*   –ò–≥—Ä–æ–∫ –ê (Emerald I) —Å—ã–≥—Ä–∞–ª –º–∞—Ç—á #123.
*   –ò–≥—Ä–æ–∫ –ë (Emerald I) —Ç–æ–∂–µ –±—ã–ª –≤ –º–∞—Ç—á–µ #123.
*   –ú—ã —Å–∫–∞—á–∏–≤–∞–µ–º –º–∞—Ç—á #123 –¥–≤–∞–∂–¥—ã -> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è -> –õ–∏–º–∏—Ç—ã API —Ç—Ä–∞—Ç—è—Ç—Å—è –≤–ø—É—Å—Ç—É—é.

## üõ† –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: The Pipeline

–ú—ã —Ä–∞–∑–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ 3 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —ç—Ç–∞–ø–∞ (Cron Jobs).

### 1. –≠—Ç–∞–ø "–†–∞–∑–≤–µ–¥–∫–∞" (Player Discovery)
**–ó–∞–¥–∞—á–∞:** –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ PUUID –∏–≥—Ä–æ–∫–æ–≤ –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–Ω–≥–∞.
**–ò—Å—Ç–æ—á–Ω–∏–∫:** `/lol/league-exp/v4/entries/{queue}/{tier}/{division}` (–∏ `/lol/league/v4` –¥–ª—è Apex —Ç–∏—Ä–æ–≤).

*   –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Page 1, 2, ...) –¥–ª—è `EMERALD I`, `EMERALD II`, `DIAMOND IV` –∏ —Ç.–¥.
*   –ú—ã **–ù–ï** —Ö—Ä–∞–Ω–∏–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ—É –æ–± –∏–≥—Ä–æ–∫–µ (–∏–º—è, –∏–∫–æ–Ω–∫—É). –ù–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ `PUUID` –∏ –µ–≥–æ —Ç–µ–∫—É—â–∏–π `TIER`.
*   –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É `tracked_players` (–∫–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—ç—à).
*   *–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:* –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–∂–µ –µ—Å—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –Ω–µ–¥–∞–≤–Ω–æ ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º.

### 2. –≠—Ç–∞–ø "–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å" (Match Queueing)
**–ó–∞–¥–∞—á–∞:** –ù–∞–π—Ç–∏ ID –º–∞—Ç—á–µ–π, –≤ –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–∞–ª–∏ —ç—Ç–∏ –ª—é–¥–∏, –Ω–æ **–Ω–µ —Å–∫–∞—á–∏–≤–∞—Ç—å** –¥–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞.
**–ò—Å—Ç–æ—á–Ω–∏–∫:** `/lol/match/v5/matches/by-puuid/{puuid}/ids`

*   –ë–µ—Ä–µ–º –ø–∞—á–∫—É `PUUID` –∏–∑ `tracked_players`.
*   –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ ID –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 –º–∞—Ç—á–µ–π.
*   **–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** –ü—ã—Ç–∞–µ–º—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–∏ ID –≤ —Ç–∞–±–ª–∏—Ü—É `matches_queue`.
    *   –¢–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç `match_id` –∫–∞–∫ Primary Key.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ–º `ON CONFLICT DO NOTHING`.
    *   –ï—Å–ª–∏ –º–∞—Ç—á #123 —É–∂–µ –Ω–∞—à–µ–ª –¥—Ä—É–≥–æ–π –∏–≥—Ä–æ–∫ ‚Äî –º—ã –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ–≥–æ.
*   –°—Ç–∞—Ç—É—Å –≤ –æ—á–µ—Ä–µ–¥–∏: `PENDING`.

### 3. –≠—Ç–∞–ø "–°–±–æ—Ä –∏ –ê–Ω–∞–ª–∏–∑" (Processing)
**–ó–∞–¥–∞—á–∞:** –°–∫–∞—á–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–∏—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
**–ò—Å—Ç–æ—á–Ω–∏–∫:** `/lol/match/v5/matches/{matchId}`

*   –ë–µ—Ä–µ–º –ø–∞—á–∫—É –º–∞—Ç—á–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING` –∏–∑ `matches_queue`.
*   –°–∫–∞—á–∏–≤–∞–µ–º JSON –º–∞—Ç—á–∞.
*   **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—á–∞:** –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –∏–≥—Ä—ã (`gameVersion`) –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º –ø–∞—Ç—á–µ–º ‚Äî –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ `SKIPPED` –∏ –≤—ã–∫–∏–¥—ã–≤–∞–µ–º. –ù–∞–º –Ω–µ –Ω—É–∂–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ç—á–µ–π –≤ "Live" –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.
*   **–ü–∞—Ä—Å–∏–Ω–≥:**
    *   –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –≤—Å–µ–º 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.
    *   –°–æ—Ö—Ä–∞–Ω—è–µ–º: `championId`, `win`, `teamPosition`, `tier` (–±–µ—Ä–µ–º –∏–∑ –º–∞—Ç—á–∞ –∏–ª–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º —Å –Ω–∞—à–µ–π –±–∞–∑–æ–π), `bans`.
*   –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É `match_participants_stats` (–ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞).
*   –ü–æ–º–µ—á–∞–µ–º –º–∞—Ç—á –≤ –æ—á–µ—Ä–µ–¥–∏ –∫–∞–∫ `COMPLETED`.

---

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (Supabase)

### `tracked_players`
(–ù—É–∂–Ω–∞, —á—Ç–æ–±—ã –Ω–µ –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å –õ–∏–≥–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –∞ –∏–º–µ—Ç—å –ø—É–ª –ø—É–∏–¥–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- `puuid` (PK)
- `tier` (EMERALD, DIAMOND...)
- `division` (I, II...)
- `last_scan_time` (timestamp)

### `matches_queue`
(–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ö–∞–± –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)
- `match_id` (PK, text) - –Ω–∞–ø—Ä–∏–º–µ—Ä `RU_12345678`
- `status` (enum: PENDING, PROCESSED, SKIPPED, FAILED)
- `created_at`

### `match_participants_stats`
(–°—é–¥–∞ –ø–∏—à–µ–º –∏—Ç–æ–≥, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- `id`
- `match_id` (FK)
- `patch_version` (text) - "14.23"
- `champion_id` (int)
- `win` (boolean)
- `position` (TOP, JUNGLE...)
- `tier` (text) - —Ä–∞–Ω–≥ –∏–≥—Ä–æ–∫–∞ –≤ —ç—Ç–æ–º –º–∞—Ç—á–µ

---

## üîÑ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ö—Ä–æ–Ω–æ–≤ (pg_cron)

1.  **`discover-players`** (–†–∞–∑ –≤ 30 –º–∏–Ω):
    *   –ë–µ—Ä–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –¢–∏—Ä/–î–∏–≤–∏–∑–∏–æ–Ω.
    *   –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–≥—Ä–æ–∫–æ–≤.
    *   Upsert –≤ `tracked_players`.

2.  **`queue-matches`** (–ö–∞–∂–¥—ã–µ 2-5 –º–∏–Ω):
    *   –ë–µ—Ä–µ—Ç 50 –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ `tracked_players`, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–≤–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å.
    *   –ü–æ–ª—É—á–∞–µ—Ç –∏—Ö MatchIDs.
    *   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–µ ID –≤ `matches_queue`.

3.  **`process-matches`** (–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É / –ø–æ—Å—Ç–æ—è–Ω–Ω–æ):
    *   –ë–µ—Ä–µ—Ç 20 –º–∞—Ç—á–µ–π `PENDING` –∏–∑ `matches_queue`.
    *   –°–∫–∞—á–∏–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏.
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ç—á.
    *   –ü–∏—à–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
    *   –°—Ç–∞–≤–∏—Ç `PROCESSED`.

